{% extends "base.html" %}

{% block title %}Kargo Detayı - {{ kargo.takip_no }}{% endblock %}

{% block content %}

<a href="{% url 'cargo_list' %}" class="btn btn-link px-0 mb-3 text-primary fw-bold">
    ← Kargo Listesine Dön
</a>

<div class="card shadow-lg p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <h2 class="fw-bolder text-primary mb-0">Takip No: {{ kargo.takip_no }}</h2>
        {% if kargo.durum == "TESLIM" %}
            <span class="badge bg-success fs-6 p-2">TESLİM EDİLDİ</span>
        {% elif kargo.durum == "DAGITIMDA" %}
            <span class="badge bg-primary fs-6 p-2">DAĞITIMDA</span>
        {% else %}
            <span class="badge bg-warning text-dark fs-6 p-2">YOLDA / İŞLENİYOR</span>
        {% endif %}
    </div>
    
    <hr class="mt-3 mb-4">

    <h5 class="fw-bold text-secondary mb-3">Kargo İlerlemesi</h5>
    
    {% if kargo.durum == "TESLIM" %}
        <div class="progress mb-4" role="progressbar" aria-label="Kargo İlerlemesi" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar bg-success" style="width: 100%">
                %100 (Teslim Edildi)
            </div>
        </div>
    {% elif kargo.durum == "DAGITIMDA" %}
        {# 75% - Dağıtımda #}
        <div class="progress mb-4" role="progressbar" aria-label="Kargo İlerlemesi" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar bg-primary" style="width: 75%">
                %75 (Dağıtımda)
            </div>
        </div>
    {% else %}
        {# 40% - Yolda / İşleniyor #}
        <div class="progress mb-4" role="progressbar" aria-label="Kargo İlerlemesi" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar bg-warning text-dark" style="width: 40%">
                %40 (Yolda)
            </div>
        </div>
    {% endif %}

    <div class="row">
        <div class="col-md-6 border-end">
            <h5 class="fw-bold text-dark mb-3">Alıcı ve Adres Bilgileri</h5>
            <p class="mb-1"><strong>Alıcı:</strong> {{ kargo.alici }}</p>
            <p class="mb-1"><strong>Adres:</strong> {{ kargo.adres }}</p>
            <p class="mb-1"><strong>Oluşturma:</strong> {{ kargo.olusturma|date:"d.m.Y H:i" }}</p>
        </div>
        <div class="col-md-6">
            <h5 class="fw-bold text-dark mb-3">Finansal Detaylar</h5>
            <p class="mb-1"><strong>Ücret:</strong> <span class="text-success fw-bold">{{ kargo.fiyat }} ₺</span></p>
            <p class="mb-1"><strong>Ödeme Durumu:</strong> Ödendi</p>
            <p class="mb-1"><strong>Güncelleme:</strong> {{ kargo.guncelleme|date:"d.m.Y H:i" }}</p>
        </div>
    </div>

</div>


<h3 class="fw-bold text-secondary mt-5 mb-4">Gönderi Takip Geçmişi</h3>

{% if kargo.gecmis %}
<div class="timeline">
    {% for adim in kargo.gecmis reversed %}
    <div class="timeline-item">
        <div class="timeline-point 
            {% if forloop.first %}bg-success{% elif adim.konum == 'Gönderi Kabul Edildi' %}bg-primary{% else %}bg-secondary{% endif %}">
        </div>
        <div class="timeline-content card shadow-sm p-3 mb-3">
            <div class="fw-bold text-dark">{{ adim.konum }}</div>
            <small class="text-muted">{{ adim.detay }}</small>
            <small class="text-end fw-bold mt-1 d-block">{{ adim.tarih|date:"d.m.Y H:i" }}</small>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
    <p class="alert alert-warning text-center">Takip geçmişi henüz oluşmamıştır.</p>
{% endif %}

<style>
    .timeline {
        border-left: 2px solid #ccc; /* Ana çizgi */
        position: relative;
        padding-left: 20px;
        margin-left: 10px;
    }
    .timeline-item {
        position: relative;
        margin-bottom: 20px;
    }
    .timeline-point {
        position: absolute;
        left: -29px; 
        top: 0;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: #f8f9fa; 
        border: 2px solid white; 
        z-index: 10;
    }
</style>

{% endblock %}